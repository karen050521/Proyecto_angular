<!-- Botón flotante de chat -->
<button 
  class="floating-chat-btn" 
  (click)="toggleChat()"
  [class.active]="isChatOpen"
  aria-label="Abrir chat"
  title="Chat"
  type="button">
  <i class="bi" [class.bi-chat-dots]="!isChatOpen" [class.bi-x-lg]="isChatOpen"></i>
  <span class="chat-badge" *ngIf="unreadCount > 0 && !isChatOpen">{{unreadCount}}</span>
</button>

<!-- Ventana de chat -->
<div class="chat-window" [class.open]="isChatOpen">
  <!-- Header del chat -->
  <div class="chat-header">
    <div class="chat-header-info">
      <i class="bi bi-robot"></i>
      <div>
        <h3>Asistente Virtual</h3>
        <span class="chat-status">En línea</span>
      </div>
    </div>
    <button class="chat-close-btn" (click)="toggleChat()" aria-label="Cerrar chat" type="button">
      <i class="bi bi-x-lg"></i>
    </button>
  </div>

  <!-- Cuerpo del chat -->
  <div class="chat-body" #chatBody>
    <!-- Mensajes -->
    <div *ngFor="let message of messages" 
         class="message" 
         [class.sent]="message.type === 'sent'"
         [class.received]="message.type === 'received'">
      <div class="message-avatar" *ngIf="message.type === 'received'">
        <i class="bi bi-robot"></i>
      </div>
      <div class="message-content">
        <div class="message-bubble">
          <p>{{message.text}}</p>
          <span class="message-time">{{message.time}}</span>
        </div>
      </div>
    </div>

    <!-- Indicador de escritura (cuando el bot está respondiendo) -->
    <div class="message received typing-indicator" *ngIf="isLoading">
      <div class="message-avatar">
        <i class="bi bi-robot"></i>
      </div>
      <div class="message-content">
        <div class="message-bubble typing">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Mensaje de ejemplo si no hay mensajes -->
    <div class="empty-state" *ngIf="messages.length === 0">
      <i class="bi bi-robot"></i>
      <p>¡Hola! Soy tu asistente virtual</p>
      <span>Pregúntame sobre el sistema de domicilios</span>
    </div>
  </div>

  <!-- Footer del chat - Input de mensaje -->
  <div class="chat-footer">
    <button class="chat-attach-btn" aria-label="Adjuntar archivo" type="button">
      <i class="bi bi-paperclip"></i>
    </button>
    <input 
      type="text" 
      class="chat-input" 
      placeholder="Escribe un mensaje..."
      [(ngModel)]="newMessage"
      (keyup.enter)="sendMessage()"
      aria-label="Escribe un mensaje"
    />
    <button 
      class="chat-send-btn" 
      (click)="sendMessage()"
      [disabled]="!newMessage.trim()"
      aria-label="Enviar mensaje"
      type="button">
      <i class="bi bi-send-fill"></i>
    </button>
  </div>
</div>
